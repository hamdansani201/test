<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Mutabaah System</title>
    <link rel="manifest" href="manifest.json">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #0d1117; color: white; margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; }
        .container { width: 90%; max-width: 400px; text-align: center; }
        
        /* Gaya Butang & Input */
        button { width: 100%; padding: 15px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 16px; }
        input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #30363d; background: #161b22; color: white; box-sizing: border-box; }
        
        /* Warna Tema */
        .btn-install { background-color: #3498db; color: white; }
        .btn-daftar { background-color: #2ecc71; color: white; }
        .btn-utama { background-color: #238636; color: white; }

        /* Sembunyi Skrin */
        #page-1, #page-2, #page-3 { display: none; width: 100%; }
        
        /* Skrin Aktif */
        .active { display: block !important; }
    </style>
</head>
<body>

    <div class="container">
        
        <div id="page-1">
            <img src="logo.png" alt="App Logo" style="width: 100px; margin-bottom: 20px;">
            <h1>Selamat Datang</h1>
            <p>Sila pasang aplikasi ke skrin utama anda untuk mula menggunakan sistem ini.</p>
            <button id="btnInstall" class="btn-install">ðŸ“² PASANG APLIKASI SEKARANG</button>
            <p style="font-size: 12px; color: #8b949e; margin-top: 20px;">Atau buka terus di browser jika sudah dipasang.</p>
            <button onclick="navigasiKeDaftar()" style="background:none; color: #58a6ff; text-decoration: underline;">Terus ke Pendaftaran</button>
        </div>

        <div id="page-2">
            <h2>Pendaftaran Pengguna</h2>
            <p>Masukkan nama anda untuk mula merekod amalan.</p>
            <input type="text" id="input-nama" placeholder="Taip nama anda di sini...">
            <button onclick="prosesDaftar()" class="btn-daftar">DAFTAR & MASUK</button>
        </div>

        <div id="page-3">
            <div style="background: #161b22; padding: 20px; border-radius: 15px; border: 1px solid #30363d;">
                <h3>Ramadan 1447H</h3>
                <p>Digital Mutabaah System</p>
                <hr style="border: 0.5px solid #30363d;">
                <p>ðŸ‘¤ Nama: <strong id="papar-nama"></strong></p>
                
                <div style="background: #0d1117; padding: 15px; border-radius: 10px; margin-top: 20px;">
                    <p>Mata Terkumpul: ðŸ’Ž 0</p>
                    <button class="btn-utama">SIMPAN AMALAN DIGITAL</button>
                </div>
                
                <button onclick="logKeluar()" style="background:none; color: #f85149; font-size: 12px; margin-top: 30px;">Log Keluar / Tukar Nama</button>
            </div>
        </div>

    </div>

    <script>
        // --- LOGIK NAVIGASI ---
        function navigasiKeDaftar() {
            tukarSkrin('page-2');
        }

        function tukarSkrin(pageId) {
            document.getElementById('page-1').classList.remove('active');
            document.getElementById('page-2').classList.remove('active');
            document.getElementById('page-3').classList.remove('active');
            document.getElementById(pageId).classList.add('active');
        }

        // --- LOGIK DAFTAR ---
        function prosesDaftar() {
            const nama = document.getElementById('input-nama').value;
            if (nama === "") {
                alert("Sila masukkan nama!");
                return;
            }
            localStorage.setItem('user_nama', nama);
            bukaAplikasi(nama);
        }

        function bukaAplikasi(nama) {
            document.getElementById('papar-nama').innerText = nama;
            tukarSkrin('page-3');
        }

        function logKeluar() {
            localStorage.removeItem('user_nama');
            location.reload();
        }

        // --- LOGIK PWA (INSTALL) ---
        let deferredPrompt;
        const btnInstall = document.getElementById('btnInstall');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            tukarSkrin('page-1'); // Tunjukkan Page 1 jika belum install
        });

        btnInstall.addEventListener('click', (e) => {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    navigasiKeDaftar();
                }
                deferredPrompt = null;
            });
        });

        // --- CHECK STATUS USER SEMASA LOAD ---
        window.onload = function() {
            const namaLama = localStorage.getItem('user_nama');
            if (namaLama) {
                bukaAplikasi(namaLama);
            } else {
                // Jika belum daftar, tunjuk Page 1 (Install)
                tukarSkrin('page-1');
            }
        };

        // Daftar Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>
</html>
